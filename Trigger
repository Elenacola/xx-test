--ESEMPIO DI TRIGGER INSTEAD OF
CREATE OR REPLACE TRIGGER Modifica_Vista_Clienti
INSTEAD OF UPDATE ON VW_CLIENTI
REFERENCING OLD AS O NEW AS N
FOR EACH ROW
BEGIN
    --Modifica della CARDS_TEMP
    UPDATE CARDS_TEMP 
    SET 
    ULTIMASPESA = SYSDATE,
    BOLLINI = :N.MONTE_BOLLINI
    WHERE CODFIDELITY = :O.CODFIDELITY;
    
    --Modifica della CLIENTI
    UPDATE CLIENTI
    SET 
    STATO = 'Attivo'
    WHERE CODFIDELITY = :O.CODFIDELITY;
    
END Modifica_Vista_Clienti;

UPDATE CLIENTI SET STATO = 'Non Attivo'
WHERE CODFIDELITY = '67100819';

SELECT * FROM VW_CLIENTI
WHERE CODFIDELITY = '67100819';

UPDATE VW_CLIENTI
SET monte_bollini = 275
WHERE CODFIDELITY = '67100819';

ROLLBACK;


-----
--Esempio Creazione Trigger con variabile :NEW
CREATE OR REPLACE TRIGGER Before_Insert_Sconti
BEFORE INSERT ON SCONTI
    FOR EACH ROW
BEGIN
    :NEW.ID := ID_SCONTI_SEQ.NEXTVAL;
    :NEW.CREAZIONE := SYSDATE;
    :NEW.VALORE := 5;
    :NEW.ANNO := EXTRACT(YEAR FROM SYSDATE);
    :NEW.SCADENZA := SYSDATE + 30;
END;


INSERT INTO SCONTI(CODFIDELITY)
VALUES('67500125');

select * from SCONTI;
